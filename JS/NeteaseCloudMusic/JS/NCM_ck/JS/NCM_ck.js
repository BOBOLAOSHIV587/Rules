/**************************************
æœ¬è„šæœ¬æ—¨åœ¨å®žçŽ°ç½‘æ˜“äº‘éŸ³ä¹å…±äº« by @Sliverkissï¼Œæ”¯æŒSurge,Loon,QuantumultXï¼Œå…¶å®ƒè½¯ä»¶è‡ªè¡Œæµ‹è¯•

è‡´è°¢ï¼š
- æœ¬è„šæœ¬åœ¨@RuRu6çš„åŸºç¡€ä¸Šé™ä½Žäº†èŽ·å–å’Œç®¡ç†ckçš„éš¾åº¦ï¼Œä½¿å¾—å°ç™½æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚
- ä»£ä»·æ˜¯é¢‘ç¹è¯»å–æ•°æ®æŒä¹…åŒ–æ‰€å¸¦æ¥çš„å¾®ä¸è¶³é“çš„æ€§èƒ½æŸè€—ã€‚

ä½¿ç”¨æ•™ç¨‹ï¼š
1.å°†è„šæœ¬æ‹‰å–åˆ°æœ¬åœ°ï¼Œé€šè¿‡æ·å¾„æ‰“å¼€èŽ·å–ckå¼€å…³
2.æ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹ï¼Œç­‰å¾…1~2ç§’ï¼Œç›´åˆ°å‡ºçŽ°ç›¸å…³è„šæœ¬é€šçŸ¥
3.èŽ·å–ckæˆåŠŸåŽï¼Œåœ¨æ·å¾„ä¸­å°†èŽ·å–ckå¼€å…³å…³é—­ï¼Œé¿å…äº§ç”Ÿä¸å¿…è¦çš„éº»çƒ¦

æ·å¾„åœ°å€ï¼šhttps://www.icloud.com/shortcuts/06b6e7b8e3344de59b593e03daba3762

å…³äºŽä¼šå‘˜æ•°æ®å¦‚ä½•åˆ†äº«ç»™å¥½å‹ï¼š
1.æ‰“å¼€æ·å¾„ï¼Œç‚¹å‡»å¯¼å‡ºæ•°æ®ï¼Œå°†å…¶å‘é€ç»™è¢«å…±äº«å¥½å‹
2.è¢«å…±äº«å¥½å‹é€šè¿‡æ·å¾„ä¸€é”®å¯¼å…¥ä¼šå‘˜æ•°æ®
3.å°†æœ¬è„šæœ¬æ‹‰å–åˆ°æœ¬åœ°ï¼Œåœ¨æ·å¾„å…³é—­èŽ·å–ckå¼€å…³ï¼Œå³å¯äº«å—ä¼šå‘˜æœåŠ¡

psï¼šèŽ·å–cké»˜è®¤å…³é—­ï¼Œå¯æ ¹æ®éœ€æ±‚åœ¨æ·å¾„æˆ–boxjsè®¢é˜…ä¸­æ‰‹åŠ¨æ‰“å¼€

boxjsè®¢é˜…åœ°å€ï¼šhttps://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/boxjs.json

QuantumultXé…ç½®å¦‚ä¸‹ï¼š

[rewrite_local]
^https:\/\/interface3?\.music\.163\.com\/eapi\/playermode\/ url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https:\/\/interface3?\.music\.163\.com\/eapi\/search\/complex\/(page|rec\/song\/get) url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https:\/\/interface3?\.music\.163\.com\/eapi\/song\/(chorus|enhance\/|play\/|type\/detail\/get) url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https:\/\/interface3?\.music\.163\.com\/eapi\/(v1\/artist\/top\/song|v3\/discovery\/recommend\/songs) url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https:\/\/interface3?\.music\.163\.com\/eapi\/vipnewcenter\/app\/resource\/newaccountpage url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https?:\/\/interface3?\.music\.163\.com\/eapi\/(homepage\/|v6\/)?playlist\/ url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

^https?:\/\/interface3?\.music\.163\.com\/eapi\/vipauth\/app\/auth\/(soundquality\/)?query url script-request-header https://gist.githubusercontent.com/Sliverkiss/479ecf770801bb8d3efa514c56a699e7/raw/WyyCrack.js

[mitm]
hostname = *.music.163.com

------------------------------------------
âš ï¸ã€å…è´£å£°æ˜Žã€‘
------------------------------------------
1ã€æ­¤è„šæœ¬ä»…ç”¨äºŽå­¦ä¹ ç ”ç©¶ï¼Œä¸ä¿è¯å…¶åˆæ³•æ€§ã€å‡†ç¡®æ€§ã€æœ‰æ•ˆæ€§ï¼Œè¯·æ ¹æ®æƒ…å†µè‡ªè¡Œåˆ¤æ–­ï¼Œæœ¬äººå¯¹æ­¤ä¸æ‰¿æ‹…ä»»ä½•ä¿è¯è´£ä»»ã€‚
2ã€ç”±äºŽæ­¤è„šæœ¬ä»…ç”¨äºŽå­¦ä¹ ç ”ç©¶ï¼Œæ‚¨å¿…é¡»åœ¨ä¸‹è½½åŽ 24 å°æ—¶å†…å°†æ‰€æœ‰å†…å®¹ä»Žæ‚¨çš„è®¡ç®—æœºæˆ–æ‰‹æœºæˆ–ä»»ä½•å­˜å‚¨è®¾å¤‡ä¸­å®Œå…¨åˆ é™¤ï¼Œè‹¥è¿åè§„å®šå¼•èµ·ä»»ä½•äº‹ä»¶æœ¬äººå¯¹æ­¤å‡ä¸è´Ÿè´£ã€‚
3ã€è¯·å‹¿å°†æ­¤è„šæœ¬ç”¨äºŽä»»ä½•å•†ä¸šæˆ–éžæ³•ç›®çš„ï¼Œè‹¥è¿åè§„å®šè¯·è‡ªè¡Œå¯¹æ­¤è´Ÿè´£ã€‚
4ã€æ­¤è„šæœ¬æ¶‰åŠåº”ç”¨ä¸Žæœ¬äººæ— å…³ï¼Œæœ¬äººå¯¹å› æ­¤å¼•èµ·çš„ä»»ä½•éšç§æ³„æ¼æˆ–å…¶ä»–åŽæžœä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚
5ã€æœ¬äººå¯¹ä»»ä½•è„šæœ¬å¼•å‘çš„é—®é¢˜æ¦‚ä¸è´Ÿè´£ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºŽç”±è„šæœ¬é”™è¯¯å¼•èµ·çš„ä»»ä½•æŸå¤±å’ŒæŸå®³ã€‚
6ã€å¦‚æžœä»»ä½•å•ä½æˆ–ä¸ªäººè®¤ä¸ºæ­¤è„šæœ¬å¯èƒ½æ¶‰å«Œä¾µçŠ¯å…¶æƒåˆ©ï¼Œåº”åŠæ—¶é€šçŸ¥å¹¶æä¾›èº«ä»½è¯æ˜Žï¼Œæ‰€æœ‰æƒè¯æ˜Žï¼Œæˆ‘ä»¬å°†åœ¨æ”¶åˆ°è®¤è¯æ–‡ä»¶ç¡®è®¤åŽåˆ é™¤æ­¤è„šæœ¬ã€‚
7ã€æ‰€æœ‰ç›´æŽ¥æˆ–é—´æŽ¥ä½¿ç”¨ã€æŸ¥çœ‹æ­¤è„šæœ¬çš„äººå‡åº”è¯¥ä»”ç»†é˜…è¯»æ­¤å£°æ˜Žã€‚æœ¬äººä¿ç•™éšæ—¶æ›´æ”¹æˆ–è¡¥å……æ­¤å£°æ˜Žçš„æƒåˆ©ã€‚ä¸€æ—¦æ‚¨ä½¿ç”¨æˆ–å¤åˆ¶äº†æ­¤è„šæœ¬ï¼Œå³è§†ä¸ºæ‚¨å·²æŽ¥å—æ­¤å…è´£å£°æ˜Žã€‚
******************************************/
const $ = init();
//è„šæœ¬åç§°
$.name = "ç½‘æ˜“äº‘éŸ³ä¹ä¼šå‘˜å…±äº«"
//æ•°æ®æŒä¹…åŒ–
const ckName = 'wyy_crack';
//ckæ•°æ®
const ck = $.getjson(ckName) || {};
//æ‰“å¼€è‡ªåŠ¨èŽ·å–ck
const is_open = ck?.is_open || `false`;
//è¯·æ±‚å¤´å¤§å°å†™è½¬æ¢
const headers = ObjectKeys2LowerCase($request.headers);
//åˆ¤æ–­æ˜¯å¦æ‰“å¼€æ•èŽ·ck
try {
    if (is_open == `true` && $request.url.match(/eapi\/(homepage\/|v6\/)?playlist\/official\/ids\/get/)) {
        let obj = {
            "mconfig-info": headers[`mconfig-info`],
            "user-agent": headers[`user-agent`],
            "cookie": headers[`cookie`]
        }
        if (headers[`mconfig-info`] && headers[`user-agent`] && headers[`cookie`]) {
            $.setjson(obj, ckName);
            $.msg($.name, "", "ðŸŽ‰èŽ·å–ä¼šå‘˜æ•°æ®æˆåŠŸï¼");
        } else {
            $.msg($.name, "", "âŒèŽ·å–ä¼šå‘˜æ•°æ®å¤±è´¥ï¼");
        }
    } else {
        if (ck[`mconfig-info`]&&ck[`cookie`]&&ck[`user-agent`]) {
                Object.assign(headers, {
                    "mconfig-info": ck[`mconfig-info`],
                    "cookie": ck[`cookie`],
                    "user-agent": ck[`user-agent`]
                })
        } else {
            $.msg($.name, "", "âŒä¸å­˜åœ¨ckæ•°æ®,è¯·å…ˆæ ¹æ®è¯´æ˜Žå®Œæˆé…ç½®");
        }
    }
} catch (e) {
    $.log(e);
} finally {
    $.done({ headers });
}

/**
 * å¯¹è±¡å±žæ€§è½¬å°å†™
 * @param {*} obj
 * @returns
 */
function ObjectKeys2LowerCase(e){e=Object.fromEntries(Object.entries(e).map(([e,t])=>[e.toLowerCase(),t]));return new Proxy(e,{get:function(e,t,r){return Reflect.get(e,t.toLowerCase(),r)},set:function(e,t,r,n){return Reflect.set(e,t.toLowerCase(),r,n)}})}
// prettier-ignore
function init(){return isSurge=()=>void 0!==this.$httpClient,isQuanX=()=>void 0!==this.$task,getdata=t=>isSurge()?$persistentStore.read(t):isQuanX()?$prefs.valueForKey(t):void 0,setdata=(t,e)=>isSurge()?$persistentStore.write(t,e):isQuanX()?$prefs.setValueForKey(t,e):void 0,getjson=(t,e)=>{let s=e;if(this.getdata(t))try{s=JSON.parse(this.getdata(t))}catch{}return s},setjson=(t,e)=>{try{return this.setdata(JSON.stringify(t),e)}catch{return!1}},msg=(t,e,s)=>{isSurge()&&$notification.post(t,e,s),isQuanX()&&$notify(t,e,s)},log=t=>console.log(t),done=(t={})=>{$done(t)},{isSurge:isSurge,isQuanX:isQuanX,msg:msg,log:log,getdata:getdata,setdata:setdata,getjson:getjson,setjson:setjson,done:done}}
